<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width,initial-scale=1.0">
    <link rel="icon" href="<%= BASE_URL %>favicon.ico">
    <title>ZRainna的博客-详情</title>
    <link type="text/css" rel="stylesheet" href="./css/base.css" />
    <link type="text/css" rel="stylesheet" href="./css/page.css" />
  </head>
  
  <body>
    <div class="m-page">
      <div class="m-box">
        <div class="m-introduce f-flexr">
    <div class="logo"><img src="https://avatars.githubusercontent.com/u/5309877?s=460&v=4"></div>
    <div class="f-ml25 f-flex-1">
        <p class="f-mb10 f-fs26">Zrainna</p>
        <p class="f-fs12 s-fc6">比较懒，什么都没介绍。。。。。</p>
    </div>
</div>
      </div>
      
      <div class="m-box">
        <div class="m-menu f-flexr f-fs16 f-tac">
    <div class="item"><a href="./index.html">首页</a></div>
    <div class="item"><a href="./article.html">文章</a></div>
    <div class="item"><a href="./book.html">书库</a></div>
    <div class="item"><a href="./demo.html">Demo</a></div>
</div>
        
        <h1 id="经验总结-特点">经验总结-特点</h1>
<h2 id="脚本加载顺序问题">脚本加载顺序问题</h2>
<p>组件脚本加载和组件实例化顺序的处理方式。组件执行完后触发组件实例化的方法。</p>
<h2 id="mock数据定义灵活">mock数据定义灵活</h2>
<p>根据配置项灵活生成组件配置数据，模块配置数据</p>
<h2 id="根据不同的浏览器端动态加载文件">根据不同的浏览器端动态加载文件</h2>
<p>利用条件判断 import 不同的文件
解决办法： 利用继承的写法，提取公共部分，再通过继承引入不同的文件。</p>
<h2 id="后端的数据缓存方案">后端的数据缓存方案</h2>
<p>ftl缓存， 页面框架数据缓存，区块数据缓存，首屏数据缓存</p>
<h2 id="呈现系统的宏定义不能和主站的宏定义冲突">呈现系统的宏定义不能和主站的宏定义冲突</h2>
<p>现象: h5的活动页面显示了两个meta信息</p>
<h2 id="postmessage-和-message-方法的冲突">postMessage() 和 message() 方法的冲突</h2>
<p>现象: 呈现系统页面PC登录弹窗报错。window上的message事件被频繁触发，事件执行时传回的数据格式错误导致报错。</p>
<p>原因：呈现系统的PC活动页因为有一个接口要解决跨域问题，使用iframe来获取数据，其中用到了postMessage()方法，所以在主页脚本里定义了message事件。
结果会导致该页面上所有iframe里的脚本只要执行postMessage(),都会触发外面的message事件。而登录弹窗就满足这种条件。</p>
<p>message方法是写在NEJ里的，只要对数据进行格式判断，或者对域名做限制，都是能够解决的。就是要改NEJ的代码了。</p>
<h2 id="x-frame-options的使用">X-Frame-Options的使用</h2>
<p><a href="https://developer.mozilla.org/zh-CN/docs/Web/HTTP/X-Frame-Options">https://developer.mozilla.org/zh-CN/docs/Web/HTTP/X-Frame-Options</a></p>
<h2 id="登录问题总结">登录问题总结</h2>
<ol>
<li>postMessage()和message()的合理使用，使用升级NEJ包来解决。</li>
<li>iframe做代理，没有跳转，原因是<a href="http://www.kaola.com%E5%8A%A0%E4%BA%86X-Frame-Options%EF%BC%8C%E4%B8%8D%E5%85%81%E8%AE%B8%E8%A2%AB%E5%B5%8C%E5%85%A5%E5%88%B0iframe%E9%87%8C%E9%9D%A2%EF%BC%8C%E5%8E%BB%E6%8E%89%E8%BF%99%E4%B8%AA%E9%99%90%E5%88%B6%E5%90%8E%E5%8F%88%E6%9C%89%E8%B7%A8%E5%9F%9F%E9%97%AE%E9%A2%98%EF%BC%8C%E4%B8%8D%E5%85%81%E8%AE%B8%E9%80%9A%E4%BF%A1%E3%80%82%E6%9C%80%E5%90%8E%E8%A7%A3%E5%86%B3%E5%8A%9E%E6%B3%95%E8%BF%98%E6%98%AF%E6%8A%8AloginAgent.htm%E6%94%BE%E5%88%B0%E8%87%AA%E5%B7%B1%E5%B7%A5%E7%A8%8B%E9%87%8C%E3%80%82">www.kaola.com加了X-Frame-Options，不允许被嵌入到iframe里面，去掉这个限制后又有跨域问题，不允许通信。最后解决办法还是把loginAgent.htm放到自己工程里。</a></li>
<li>iframe跨域通信与同域通信的解决办法。</li>
<li>pc两种登录方式，无刷新登录和刷新登录的处理。</li>
</ol>
<h2 id="解决web工程部署慢的问题。">解决web工程部署慢的问题。</h2>
<p>因为使用了npminstall命令，所以拉下来的包文件特别大，导致打包文件很大，从而导致NOS上传慢，下载慢。
操作应该是：只拉我们需要的模块，比如@kaola/web-ftl,@kaola/wap-ftl, 其他无用的模块不用拉。</p>
<h2 id="前端可用的缓存策略-kjds-51601">前端可用的缓存策略 <a href="http://jira.netease.com/browse/KJDS-51601">KJDS-51601</a></h2>
<p>实现思路：</p>
<ol>
<li>组件类根据版本号缓存(待调研)</li>
<li>页面框架里的模块配置数据在本地缓存</li>
<li>APP内，组件合并接口的返回数据可否存在session storage里。</li>
</ol>
<blockquote>
<p>此种方案不可行,原因是每个活动页的数据是不一致的,如果活动页数据较大,则缓存的数据量也非常大,占用内存,得不偿失。</p>
</blockquote>
<h2 id="活动页面新增同步数据-kjds-55311">活动页面新增同步数据 <a href="http://jira.netease.com/browse/KJDS-55311">KJDS-55311</a></h2>
<p>实现思路：
通过JSONP请求返回的框架数据里，合并样式的URL，合并脚本的URL，页面标题，分享数据等信息改为同步返回。</p>
<blockquote>
<p>已上线</p>
</blockquote>
<h2 id="打包配置修改-kjds-55299">打包配置修改 <a href="http://jira.netease.com/browse/KJDS-55299">KJDS-55299</a></h2>
<ol>
<li>组件脚本里依赖的公共子组件单独打包</li>
<li>对更改较少的组件脚本单独打包</li>
</ol>
<blockquote>
<p>已上线</p>
</blockquote>
<h2 id="模板的占位和loading效果">模板的占位和loading效果</h2>
<ol>
<li>模块样式添加固定宽高和背景色</li>
</ol>

      </div>
    </div>
  </body>
</html>



