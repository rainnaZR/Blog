<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width,initial-scale=1.0">
    <link rel="icon" href="<%= BASE_URL %>favicon.ico">
    <title>ZRainna的博客-详情</title>
    <link type="text/css" rel="stylesheet" href="./css/base.css" />
    <link type="text/css" rel="stylesheet" href="./css/page.css" />
  </head>
  
  <body>
    <div class="m-page">
      <div class="m-box">
        <div class="m-introduce f-flexr">
    <div class="logo"><img src="https://avatars.githubusercontent.com/u/5309877?s=460&v=4"></div>
    <div class="f-ml25 f-flex-1">
        <p class="f-mb10 f-fs26">Zrainna</p>
        <p class="f-fs12 s-fc6">比较懒，什么都没介绍。。。。。</p>
    </div>
</div>
      </div>
      
      <div class="m-box">
        <div class="m-menu f-flexr f-fs16 f-tac">
    <div class="item"><a href="./index.html">首页</a></div>
    <div class="item"><a href="./article.html">文章</a></div>
    <div class="item"><a href="./book.html">书库</a></div>
    <div class="item"><a href="./demo.html">Demo</a></div>
</div>
        
        <h1 id="呈现页面前端性能测试报告一（pagespeed）">呈现页面前端性能测试报告一（Pagespeed）</h1>
<h2 id="环境说明">环境说明</h2>
<ul>
<li>测试URL：
<a href="https://pages.kaola.com/pages/activity/j6itd6uupagert.shtml">https://pages.kaola.com/pages/activity/j6itd6uupagert.shtml</a></li>
<li>工具网址： <a href="https://developers.google.com/speed/pagespeed/insights/">https://developers.google.com/speed/pagespeed/insights/</a></li>
<li>适配端：移动设备</li>
<li>网络条件：公司网络</li>
</ul>
<h2 id="结果分析">结果分析</h2>
<h4 id="评分结果">评分结果</h4>
<table>
<thead>
<tr>
<th>网址</th>
<th>总评分(满分100)</th>
<th>说明</th>
</tr>
</thead>
<tbody><tr>
<td><a href="https://pages.kaola.com/pages/activity/j6itd6uupagert.shtml">https://pages.kaola.com/pages/activity/j6itd6uupagert.shtml</a></td>
<td>50</td>
<td>移动设备，呈现系统活动页</td>
</tr>
<tr>
<td><a href="https://m.jd.com">https://m.jd.com</a></td>
<td>71</td>
<td>桌面设备</td>
</tr>
<tr>
<td><a href="https://m.tmall.com">https://m.tmall.com</a></td>
<td>70</td>
<td>移动设备</td>
</tr>
<tr>
<td><a href="https://m.kaola.com">https://m.kaola.com</a></td>
<td>63</td>
<td>移动设备</td>
</tr>
<tr>
<td><a href="https://m.kaola.com/activity/h5/34220.shtml">https://m.kaola.com/activity/h5/34220.shtml</a></td>
<td>46</td>
<td>移动设备，超市活动页</td>
</tr>
</tbody></table>
<h4 id="推荐的优化措施">推荐的优化措施</h4>
<p>工具推荐的优化措施： <a href="https://developers.google.com/speed/pagespeed/insights/?url=https%3A%2F%2Fpages.kaola.com%2Fpages%2Factivity%2Fj6itd6uupagert.shtml">https://developers.google.com/speed/pagespeed/insights/?url=https%3A%2F%2Fpages.kaola.com%2Fpages%2Factivity%2Fj6itd6uupagert.shtml</a></p>
<p><strong>1. 清除首屏内容中阻止呈现的JS和Css</strong></p>
<p>现在活动页面中需要加载的脚本包括： common.js, vendor.js, vendor-h5.js, init.js, index.js, 以及合并脚本等。</p>
<p>每增加一个脚本，就增加一次网络往返过程，增加网络开销。而上面这些脚本因为打包的关系，不能再合并成一个文件，所以利用nginx的concat功能来对脚本合并。</p>
<blockquote>
<p>解决措施：</p>
</blockquote>
<blockquote>
<ol>
<li>将common.js,vendor.js,vendor-h5.js,init.js路径合并</li>
</ol>
</blockquote>
<p>样式文件除了进行合并外，样式的大小也会影响首屏的显示。在样式文件未加载好前，即使dom树生成好了也不会显示，所以样式文件如果较大，需要识别出首屏内容需要的css,等首屏内容显示之后再加载剩余样式。</p>
<blockquote>
<p>解决措施：</p>
</blockquote>
<blockquote>
<ol>
<li>将vendor.css,vendor-h5.css,index.css路径合并</li>
</ol>
</blockquote>
<blockquote>
<ol start="2">
<li>ftl同步渲染只引用合并组件样式列表中的前几个，剩余样式通过JS异步插入</li>
</ol>
</blockquote>
<p><strong>2. 优化图片</strong></p>
<p>页面上无论什么样大小的图片，都需要加上nos的图片裁剪参数，对图片进行压缩优化。呈现页面上线的模块中，有些小图标没有添加参数。</p>
<p>页面上所有图片统一做懒加载，包括首屏模块。</p>
<blockquote>
<p>解决措施：</p>
</blockquote>
<blockquote>
<ol>
<li>检查所有已开发模块的图片链接。</li>
</ol>
</blockquote>
<blockquote>
<ol start="2">
<li>增加小工具，检查页面上所有的图片链接。只运行在本地环境或测试环境，如果有出现参数没加的情况，报错提示。</li>
</ol>
</blockquote>
<blockquote>
<ol start="3">
<li>优化getImgThumbnailDimension()方法，根据网络条件来决定是否调用</li>
</ol>
</blockquote>
<p><strong>3. 使用浏览器缓存</strong></p>
<p>浏览器缓存这里不详细介绍，参考<a href="http://web.jobbole.com/84888/">http://web.jobbole.com/84888/</a></p>
<blockquote>
<p>解决措施：</p>
</blockquote>
<blockquote>
<ol>
<li>静态资源上cdn，包括css,images,js,fonts等。</li>
</ol>
</blockquote>
<blockquote>
<ol start="2">
<li>dns-prefetch,preload的资源补充完成。</li>
</ol>
</blockquote>
<blockquote>
<ol start="3">
<li>不同的静态资源设置不同的缓存有效期。框架数据的缓存时间为2分钟，可否延长。首屏接口，组件异步数据获取接口的缓存时间目前为10秒，可否延长。css,js,font缓存在cdn，缓存时间为30天。</li>
</ol>
</blockquote>
<p><strong>4. 按优先级排列可见内容</strong></p>
<p>需要减少呈现首屏内容所需要的html数量。限制首屏展示需要的数据（html，图片，css和JS等）。</p>
<blockquote>
<p>解决措施：</p>
</blockquote>
<blockquote>
<ol>
<li>首屏展示的关键数据为：框架数据和首屏接口数据。查看这两个接口的耗时，调整请求顺序，优先发送这两个请求。</li>
</ol>
</blockquote>
<blockquote>
<ol start="2">
<li>图标尽量使用css或字体文件，而非图片来实现。</li>
</ol>
</blockquote>
<h1 id="呈现页面前端性能测试报告二（webpagetest）">呈现页面前端性能测试报告二（webpagetest）</h1>
<h2 id="环境说明-1">环境说明</h2>
<ul>
<li>测试URL：
<a href="https://pages.kaola.com/pages/activity/j6itd6uupagert.shtml">https://pages.kaola.com/pages/activity/j6itd6uupagert.shtml</a></li>
<li>工具网址： <a href="http://www.webpagetest.org/">http://www.webpagetest.org/</a></li>
<li>条件： Dulles, VA - iPhone 6 iOS 11 - Cable</li>
<li>测试次数：3</li>
</ul>
<h2 id="结果分析-1">结果分析</h2>
<p>第一次加载：</p>
<p><a href="https://pages.kaola.com/pages/activity/j6itd6uupagert.shtml">https://pages.kaola.com/pages/activity/j6itd6uupagert.shtml</a>
<img src="http://haitao.nos.netease.com/OWBR4cwgUD6nEIpR111-1T17010091754_1880_208.jpg" alt="default"></p>
<p><a href="https://chaoshi.m.tmall.com/">https://chaoshi.m.tmall.com/</a>
<img src="http://haitao.nos.netease.com/9WkPTQE9Tn69WcBD222-1T17010091755_1862_388.jpg" alt="default"></p>
<p>第二次加载：</p>
<p><a href="https://pages.kaola.com/pages/activity/j6itd6uupagert.shtml">https://pages.kaola.com/pages/activity/j6itd6uupagert.shtml</a>
<img src="http://haitao.nos.netease.com/A0HMHufs9vXDbNNr1111T17010091755_1634_260.jpg" alt="default"></p>
<p><a href="https://chaoshi.m.tmall.com/">https://chaoshi.m.tmall.com/</a>
<img src="http://haitao.nos.netease.com/k3PXf5eZ5ISlENwL222-2T17010091756_1868_364.jpg" alt="default"></p>
<p>第三次加载：</p>
<p><a href="https://pages.kaola.com/pages/activity/j6itd6uupagert.shtml">https://pages.kaola.com/pages/activity/j6itd6uupagert.shtml</a>
<img src="http://haitao.nos.netease.com/nGPfFv8JGDzdUiE4111-3T17010091756_1862_346.jpg" alt="default"></p>
<p><a href="https://chaoshi.m.tmall.com/">https://chaoshi.m.tmall.com/</a>
<img src="http://haitao.nos.netease.com/DezgxcJRBh456k5J2222T17010091756_1864_228.jpg" alt="default"></p>
<h4 id="对比结果，数据以呈现页面为例">对比结果，数据以呈现页面为例</h4>
<p><strong>现象1： First Byte呈现页面耗时较长</strong></p>
<p>First Byte(1.910s) = Request Start(1.508s) + Time to First Byte(402ms)</p>
<p>Request Start(1.508s) = DNS Lookup(458ms) + Initial Connection(306ms) + SSL Negotiation(720ms)</p>
<blockquote>
<p>解决办法：</p>
</blockquote>
<blockquote>
<ol>
<li>减少dns寻址时间，做dns的预加载。</li>
</ol>
</blockquote>
<blockquote>
<ol start="2">
<li>减少样式请求数量，合并vendor.css,vendor-h5.css,index.css,合并index.js,init.js,vendor-h5.js,vendor.js。</li>
</ol>
</blockquote>
<blockquote>
<ol start="3">
<li>合并脚本的JS很大，考虑是否修改打包配置来减少合并脚本的大小。</li>
</ol>
</blockquote>
<blockquote>
<ol start="4">
<li>可以把首屏的模块脚本单独合并，优先单独加载。</li>
</ol>
</blockquote>
<blockquote>
<ol start="5">
<li>对index.js瘦身，目前打包后267.1k。</li>
</ol>
</blockquote>
<p><strong>现象2：Start Render的时间比较晚</strong></p>
<p>呈现页面：Diff Time(文档下载完成到开始渲染的时间间隔差4.206s) = Start Render(6.270s) - First Byte(1.910s) - Content Download(154ms)</p>
<p>天猫超市：Diff Time(文档下载完成到开始渲染的时间间隔差2.452s) = Start Render(4.068s) - First Byte(1.431s) - Content Download(185ms)</p>
<blockquote>
<p>解决办法：</p>
</blockquote>
<blockquote>
<ol>
<li>render是在脚本加载完成后开始的，直接影响render的脚本是index.js和组件合并脚本。</li>
</ol>
</blockquote>
<blockquote>
<ol start="2">
<li>页面进来图片请求数量过多，减少图片请求，只显示首屏图片。</li>
</ol>
</blockquote>
<p>另外其他的测试工具还有阿里测，百度应用性能检测中心，PingDom Tools，GTmetrix这里不再做测试。</p>

      </div>
    </div>
  </body>
</html>



